{% if image.src %}
  {% set image_attributes = image_attributes|default(create_attribute()) %}
  {% if width and image.width > 0 %}
    {#
    Canvas can scale images, but can not currently change the aspect-ratio
    of the image. Below, we calculate the original aspect ratio, and then
    adjust the height to ensure the aspect ratio does not change. This is
    important because browsers will reserve space for the image (based on
    width and height attributes) to prevent layout shifts.

    This will need to be updated if Canvas gains the ability to change the
    image's aspect ratio.
    #}
    {% set aspect_ratio = image.width / image.height %}
    {% set height = (width / aspect_ratio)|round %}
  {% endif %}

  {% if fetchpriority %}
    {% set image_attributes = image_attributes.setAttribute('fetchpriority', fetchpriority) %}
  {% endif %}

  {{ include('canvas:image',
    image|merge({
      width: width|default(image.width),
      height: height|default(image.height),
      alt: alt|default(image.alt),
      class: class|default(''),
      loading: loading|default('lazy'),
      srcset: srcset|default(''),
      sizes: sizes|default('auto 100vw'),
      attributes: image_attributes,
    }), with_context = false) }}
{% else %}
  {% if image['#theme'] %}
    {{ image|add_suggestion('bare') }}
  {% else %}
    {{ image }}
  {% endif %}
{% endif %}
